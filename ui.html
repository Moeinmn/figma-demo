<h2>YOOOOOOOOOOOOOO!</h2>
<button>Go</button>

<iframe
  src="https://plotset.com/api/embed/0d4abe98-365d-4648-9ffd-3825ba413e98"
  id="frame"
  onclick=""
  allow-same-origin
  style="
    position: fixed;
    top: 200;
    left: 0;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 100%;
    border: none;
    margin: 0;
    padding: 0;
    overflow: hidden;
    z-index: 999999;
  "
>
</iframe>
<script>
  let iframe = document.querySelector("#frame");
  console.log({ iframe });
  let content = iframe?.contentWindow;
  console.log({ content });

  window.onload = function (e) {
    document.querySelector("button").addEventListener("click", async () => {
      content.postMessage({ command: "export_svg" }, "*");
    });

    //Receiving message from child Iframe and send it to figma
    window.onmessage = function (e) {
      if (e.data?.svg) {
        console.log("It works! parent", e.data.svg);

        const reader = new FileReader();
        reader.readAsDataURL(e.data?.svg);
        reader.onloadend = function () {
          const base64data = reader.result.split(",")[1];
          window.parent.postMessage(
            {
              pluginMessage: { type: "data_received", value: atob(base64data) },
            },
            "*"
          );
        };
      }
    };
  };
</script>
